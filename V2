import requests
from bs4 import BeautifulSoup
import re
import pandas as pd

def extract_text_from_url(url):
    response = requests.get(url)
    soup = BeautifulSoup(response.text, 'html.parser')
    return soup.get_text()

def post_process_acronyms(acronyms):
    # Remove any single-letter results
    filtered = [acr for acr in acronyms if len(acr) > 1]
    
    # Remove duplicates while preserving order
    seen = set()
    return [acr for acr in filtered if not (acr in seen or seen.add(acr))]

def find_acronyms(text):
    pattern = r'\b(?:(?:[A-Z]\.){2,}[A-Z](?:\.[A-Z])*|\d*[A-Z]+\d*(?:[-_][A-Z]+\d*)*|[A-Z][a-z]+[A-Z][A-Za-z]*)\b'
    found = re.findall(pattern, text)
    return post_process_acronyms(found)

def process_url(url, existing_acronyms):
    text = extract_text_from_url(url)
    acronyms = find_acronyms(text)
    new_acronyms = []

    for acronym in acronyms:
        if acronym not in existing_acronyms:
            new_acronyms.append(acronym)
            existing_acronyms.add(acronym)

    return new_acronyms

def main():
    # Load existing acronyms from file
    try:
        existing_df = pd.read_csv('existing_acronyms.csv')
        existing_acronyms = set(existing_df['Acronym'])
    except FileNotFoundError:
        existing_acronyms = set()

    # New acronyms will be stored here
    new_acronyms_list = []

    while True:
        url = input("Enter a URL (or 'quit' to exit): ")
        if url.lower() == 'quit':
            break

        new_acronyms = process_url(url, existing_acronyms)
        new_acronyms_list.extend([(acronym, url) for acronym in new_acronyms])

    # Create a DataFrame with new acronyms and their URLs
    new_df = pd.DataFrame(new_acronyms_list, columns=['Acronym', 'URL'])

    # If there are new acronyms, append them to the existing file or create a new one
    if not new_df.empty:
        new_df.to_csv('new_acronyms.csv', index_label='Number', mode='a', header=not existing_acronyms)
        print(f"Added {len(new_df)} new acronyms to 'new_acronyms.csv'")
    else:
        print("No new acronyms found.")

if __name__ == "__main__":
    main()
