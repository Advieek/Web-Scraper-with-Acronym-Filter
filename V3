import re
import pandas as pd
from selenium import webdriver
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.chrome.service import Service
from webdriver_manager.chrome import ChromeDriverManager
from bs4 import BeautifulSoup
import time

def setup_driver():
    chrome_options = Options()
    chrome_options.add_argument("user-data-dir=/path/to/your/chrome/profile")  # Replace with your Chrome profile path
    chrome_options.add_argument("--start-maximized")
    service = Service(ChromeDriverManager().install())
    return webdriver.Chrome(service=service, options=chrome_options)

def extract_text_from_url(driver, url):
    driver.get(url)
    time.sleep(5)  # Wait for page to load, adjust as needed
    return driver.page_source

def post_process_acronyms(acronyms):
    filtered = [acr for acr in acronyms if len(acr) > 1]
    seen = set()
    return [acr for acr in filtered if not (acr in seen or seen.add(acr))]

def find_acronyms(text):
    pattern = r'\b(?:(?:[A-Z]\.){2,}[A-Z](?:\.[A-Z])*|\d*[A-Z]+\d*(?:[-_][A-Z]+\d*)*|[A-Z][a-z]+[A-Z][A-Za-z]*)\b'
    found = re.findall(pattern, text)
    return post_process_acronyms(found)

def process_url(driver, url, existing_acronyms):
    html = extract_text_from_url(driver, url)
    soup = BeautifulSoup(html, 'html.parser')
    text = soup.get_text()
    acronyms = find_acronyms(text)
    new_acronyms = []

    for acronym in acronyms:
        if acronym not in existing_acronyms:
            new_acronyms.append(acronym)
            existing_acronyms.add(acronym)

    return new_acronyms

def main():
    driver = setup_driver()

    try:
        existing_df = pd.read_csv('existing_acronyms.csv')
        existing_acronyms = set(existing_df['Acronym'])
    except FileNotFoundError:
        existing_acronyms = set()

    new_acronyms_list = []

    try:
        while True:
            url = input("Enter a URL (or 'quit' to exit): ")
            if url.lower() == 'quit':
                break
            new_acronyms = process_url(driver, url, existing_acronyms)
            new_acronyms_list.extend([(acronym, url) for acronym in new_acronyms])

        new_df = pd.DataFrame(new_acronyms_list, columns=['Acronym', 'URL'])

        if not new_df.empty:
            new_df.to_csv('new_acronyms.csv', index_label='Number', mode='a', header=not existing_acronyms)
            print(f"Added {len(new_df)} new acronyms to 'new_acronyms.csv'")
        else:
            print("No new acronyms found.")

    finally:
        driver.quit()

if __name__ == "__main__":
    main()
